<!DOCTYPE html>
<html>
  <head>

    <link type="text/css" rel="stylesheet" href="/templates/css/bootstrap.css">

    <title> SEBCA - search engine biased color analysis </title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>



    <style media="screen">

        body{
            background-color: ##f4f4f4;
            padding-top: 0px;
        }

        header{
            margin: 0px 0px 0px 0px;
            margin-top: 0px;
            background-color: #111;
            width: 100%;
        }


        #logo{
            width: 10% ;
            height: 10% ;
            margin: 30px 20px 20px 30px;
        }

        input[type=submit] {
            height: 19px;
            width: 140px;
            padding:3px 15px;
            background:#111;
            border:0 none;
            cursor:pointer;
            -webkit-border-radius: 2px;
            border-radius: 2px;
            color: #eee;
            -webkit-transition: background 0.5s;
            transition: background 0.5s;
        }

        .card{
            height:220px;
            width:204px;
            background-color: #fff;
            box-shadow: 2px 2px 0px #bbb;
            padding-left: 4px;
            padding-top: 4px;
            text-align: center;
            border: 1px solid #bbb;
            border-radius: 2px;2
        }

        .inputpannel{
            padding-top: 30px;
            padding-bottom: 30px;
        }

        .inputbox{
            float: left;
            margin-right: 30px;
        }

        .button:hover {
            background-color: #80cd32;
        }


        .color{
          float:left;
        }


        div.color:hover{
           background-color:#FF0000;
        }

        #loading{
            float: left;
            margin: 0px 0px 0px 0px ;
            color: #111;
            height: 19px;
        }

        footer{
          background-color: black;
          bottom: 10px;
          left: 10px;
          margin: 0px 0px 0px 0px;



        }


    </style>


<!--//htmlbody---------------------------------------------------------------------------------------------->

  </head>

  <body>
    <header>
      <div class="logo">
        <img id= "logo" src='http://svgshare.com/i/14T.svg' title='sebca' />
      </div>
    </header>

  <div class="inputpannel">

      <form method="post" id="form-img-request" class="inputbox">
          Enter Phrase: <input type="text" id="phraseinput" >
          <input type="submit" value="Get me the color" class="button" onclick="loading()">
      </form>

          <p id="loading"></p>

      <form method="post" class="inputbox" hidden="true">
          Enter URL: <input id="urls" type="text" name="urllink">
          <input id = "urlbutton" type="submit" value="Analyze" class="button">
      </form>



  </div>


      <div>
        <p id= "lookuplink" value = ""></p>
      </div>


    <div class="card">
      <label>
        {% for key in dictionary %}
            <div class="color" style="background-color:rgb{{key}};color:white;padding:0px;height:150px;width: calc({{dictionary[key]}}px / {{totalpx}} * 200);"></div>
        {% endfor %}
      </label>
      <p>{{totalpx}}</p>
      <div class="keyphrase">
        <p id= "phrase"> </p>
      </div>
    </div>

    <footer>

    </footer>




<!---//script------------------------------------------------------------------------------------------------------------->



      <script type="text/javascript">
      var j = {{totalpx}};
      console.log(j);

      function loading() {
        document.getElementById("loading").innerHTML = "Loading..."
    }

      $(document).ready(function() {
          // register our function as the "callback" to be triggered by the form's submission event
          $("#form-img-request").submit(fetchAndDisplayimg); // in other words, when the form is submitted, fetchAndDisplayGif() will be executed
      });

      function fetchAndDisplayimg(event) {

         // This prevents the form submission from doing what it normally does: send a request (which would cause our page to refresh).
         // Because we will be making our own AJAX request, we dont need to send a normal request and we definitely don't want the page to refresh.
         event.preventDefault();


      var phrase = document.getElementById("phraseinput").value
      var link = ""


          $(function() {
              var params = {
                q: phrase


              };

              $.ajax({
                  url: "https://api.cognitive.microsoft.com/bing/v5.0/images/search?" + $.param(params) + "&count=9" + "&size=small",
                  beforeSend: function(xhrObj){
                      // Request headers
                      xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","74391e77720a4801ae6b74854e380300");
                  },
                  type: "POST",
                  // Request body
                  data: "{body}",
              })
              .done(function(data) {

                  var links = data.value
                    .map(function(item){return item.contentUrl})
                    .join(" ")
                  console.log(links);

                  //document.getElementById("lookuplink").value = links;
                  //document.getElementById("lookuplink").innerHTML = link; #for testing
                  document.getElementById("urls").value = links;
                  document.getElementById("urlbutton").click();
                  document.getElementById("phrase").innerHTML = phrase;
                  var con = document.getElementById("urls").value;
                  console.log(con);



              })
              .fail(function() {
                  alert("error");
              });
          });

    }
      </script>

  </body>
</html>
